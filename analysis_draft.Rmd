---
title: "HIV/AIDS Surveillance Data Analysis"
author: "Xuan Lu and Team"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: yeti
    css: style.css
---

## Project Proposal Summary

### The Team
- Junjie Hu (jh4617)
- Ruixi Li (rl33298)
- Xuan Lu (xl3214)
- Tianyun Jiang (tj2519)
- Qinting Shen (qs2261)

### Tentative Project Title
HIV/AIDS Surveillance Data Analysis across Countries

### Motivation
The primary goal is to analyze information on HIV prevalence, incidence rates, and AIDS mortality from available studies, identifying the most vulnerable gender, sub-population, and geographic region.

### Intended Final Products
Multiple dashboards/web pages reflecting the prevalence and incidence rates of HIV across countries and subgroups.

### Anticipated Data Sources
United States Censusâ€™s HIV/AIDS Surveillance Data Base

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## Data Cleaning and Preparation
```{r clean data}
# Load the dataset (assuming you have already read it into 'hiv_df')
hiv_df <- read.csv("hiv_joined_data.csv") |>
  janitor::clean_names()

# View the first few rows of the dataset
head(hiv_df)

# Display the column names
colnames(hiv_df)

# Filter data for new HIV incidences and AIDS mortality
hiv_df_filtered <- hiv_df |>
  dplyr::filter(!is.na(incidence_rate) & !is.na(num_of_deaths)) |>
  mutate(num_of_deaths = as.numeric(gsub(",", "", num_of_deaths)))

# Further filter by demographic groups if necessary
```

## Exploratory Analysis
```{r EDA}
# Histogram for HIV incidences
ggplot(hiv_df_filtered, aes(x = incidence_rate)) +
    geom_histogram(binwidth = 1, fill = "blue", color = "black")

# Summary statistics for AIDS mortality
summary(hiv_df_filtered$num_of_deaths)
```

## Statistical Testing
```{r Stat Tests}
# Load necessary libraries
library(broom)  # For tidy statistical summaries

# Chi-square test for categorical variables (e.g., gender)
chi_sq_result <- chisq.test(hiv_df_filtered$sex, hiv_df_filtered$incidence_rate)
print(glue::glue("Chi-Square Test for Gender and HIV Incidences:\n"))
print(tidy(chi_sq_result))

# ANOVA for numeric variables (e.g., age)
aov_result <- aov(num_of_deaths ~ age, data = hiv_df_filtered)
print(glue::glue("\nANOVA for AIDS Mortality by Age:\n"))
print(tidy(aov_result))

# T-test (e.g., comparing two age groups)
# Ensure 'age_group' is a valid variable in your dataset
t_test_result <- t.test(num_of_deaths ~ age, data = hiv_df_filtered)
print(glue::glue("\nT-Test for AIDS Mortality by Age Group:\n"))
print(tidy(t_test_result))

# Regression (e.g., multiple variable regression)
lm_result <- lm(num_of_deaths ~ age + sex + geographic_area, data = hiv_df_filtered)
print(glue::glue("\nLinear Regression for AIDS Mortality:\n"))
print(tidy(lm_result))
```

- Chi-Square Test: Used for testing relationships between categorical variables.
- ANOVA: Analyzes differences between group means and their associated procedures.
- T-Test: Compares the means of two groups.
- Linear Regression: Models the relationship between a dependent variable and one or more independent variables.

### Validation of Data:

- Ensure hiv_df_filtered contains the necessary columns (gender, new_hiv_incidences, aids_mortality, age, age_group, geographic_region).
- Validate the assumptions for each statistical test (e.g., normality for t-test and ANOVA, independence for Chi-square).

## Visualization
```{r visualization}
library(plotly)
library(ggplot2)

# HIV Prevalence and Incidence Rates by Country
country_plot <- plot_ly(data = hiv_df_filtered) |>
    add_trace(x = ~country, y = ~incidence_rate, name = 'Incidence Rate', type = 'bar') |>
    add_trace(x = ~country, y = ~prevalence_rate, name = 'Prevalence Rate', type = 'bar') |>
    layout(title = 'HIV Prevalence and Incidence Rates by Country',
           barmode = 'group')

print(country_plot)


# HIV Prevalence and Incidence Rates of Each Subpopulation Over Time
time_subpop_plot <- plot_ly(data = hiv_df_filtered) |>
    add_trace(x = ~year, y = ~incidence_rate, color = ~population_subgroup, type = 'scatter', mode = 'lines', name = 'Incidence Rate') |>
    add_trace(x = ~year, y = ~prevalence_rate, color = ~population_subgroup, type = 'scatter', mode = 'lines', name = 'Prevalence Rate') |>
    layout(title = 'HIV Prevalence and Incidence Rates of Each Subpopulation Over Time')

print(time_subpop_plot)


# Difference in HIV Prevalence and Incidence Rates Across Gender
gender_plot <- ggplot(hiv_df_filtered, aes(x = sex)) +
    geom_bar(aes(y = incidence_rate, fill = 'Incidence Rate'), stat = 'identity') +
    geom_bar(aes(y = prevalence_rate, fill = 'Prevalence Rate'), stat = 'identity', position = 'dodge') +
    theme_minimal() +
    labs(title = 'Difference in HIV Prevalence and Incidence Rates Across Gender')

print(gender_plot)
```

## Tables
```{r Tables}
# Load necessary libraries
library(dplyr)
library(knitr)

# Top Countries/Regions with Highest HIV Prevalences and Incidence Rates
top_countries <- hiv_df_filtered |>
    dplyr::group_by(country) |>
    dplyr::summarize(
        Average_Incidence = mean(incidence_rate, na.rm = TRUE),
        Average_Prevalence = mean(prevalence_rate, na.rm = TRUE)
    ) |>
    dplyr::arrange(desc(Average_Incidence), desc(Average_Prevalence)) |>
    head(10)

# Display the table with kable for a professional look
kable(top_countries, caption = "Top 10 Countries/Regions with Highest HIV Incidence Rates", 
      format = "html", table.attr = "style='width:100%;'", 
      col.names = c("Country/Region", "Average Incidence Rate"))

unique(hiv_df$age)
```

